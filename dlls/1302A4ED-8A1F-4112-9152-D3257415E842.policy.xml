<?xml version="1.0" encoding="utf-8"?>
<!--
Copyright (c) Microsoft Corporation.  All rights reserved.
-->
<CeSecurityPolicyFile Description="WaveAPI system security policy" Vendor="Microsoft" RequiredOSVersion="7.00" FileVersion="7.00" xmlns="urn:Microsoft.PlatformBuilder/CeSecurityPolicy">

  <!-- Capabilities -->

  
<!--Begin generating capability accounts and authorization rules for ID_CAP_MICROPHONE -->
<Macro Id="CAPMACRO_ID_CAP_MICROPHONE" Value="S-1-5-112-0-0X70-0X49445F4341505F4D4943524F50484F4E45" />
<Account Id="$(CAPMACRO_ID_CAP_MICROPHONE)" FriendlyName="ID_CAP_MICROPHONE:Provides access to the microphone" Description="Autogenerated group for capability ID_CAP_MICROPHONE" Type="Group">
<MemberOfGroup GroupAccountId="$(PUBLIC_CAPABILITIES_GROUP_NAME)" />
</Account>
<Rule Description="Authorization rule for capability ID_CAP_MICROPHONE" ResourceIri="$(GLOBAL_RESOURCES)/WAVEAPI/WAVEIN" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(CAPMACRO_ID_CAP_MICROPHONE)" AuthorizationIds="GENERIC_ALL" />
</Authorize>
</Rule>
<!--End generating capability accounts and authorization rules for ID_CAP_MICROPHONE -->


  <!-- High priority rules -->

  <Rule Description="Grant Wave API device handle open access to everyone" ResourceIri="$(DEVICEMANAGER_DEVICE)/WAM/1" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_HIGH">
    <Authorize>
      <Match AccountId="$(EVERYONE_GROUP_NAME)" AuthorizationIds="ALL_ACCESS"></Match>
    </Authorize>
  </Rule>

  <Rule Description="Grant Audio Routing Manager device handle open access to everyone" ResourceIri="$(DEVICEMANAGER_DEVICE)/ARM/1" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_HIGH">
    <Authorize>
      <Match AccountId="$(EVERYONE_GROUP_NAME)" AuthorizationIds="ALL_ACCESS"></Match>
    </Authorize>
  </Rule>

  <!-- Standard priority rules -->

  <Rule Description="Provide access to audio settings" ResourceIri="$(HKLM)/AUDIO/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(ELEVATED_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
      <Match AccountId="$(EVERYONE_GROUP_NAME)" AuthorizationIds="KEY_READ"></Match>
    </Authorize>
    <Stop>
      <Match AccountId="$(EVERYONE_GROUP_NAME)"></Match>
    </Stop>
  </Rule>

  <Rule Description="Provide access to ACM codec settings" ResourceIri="$(HKLM)/AUDIOCOMPRESSIONMANAGER/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(ELEVATED_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
      <Match AccountId="$(EVERYONE_GROUP_NAME)" AuthorizationIds="KEY_READ"></Match>
    </Authorize>
    <Stop>
      <Match AccountId="$(EVERYONE_GROUP_NAME)"></Match>
    </Stop>
  </Rule>

  <Rule Description="Provide access to ACM codec settings" ResourceIri="$(HKLM)/DRIVERS32/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(ELEVATED_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
      <Match AccountId="$(EVERYONE_GROUP_NAME)" AuthorizationIds="KEY_READ"></Match>
    </Authorize>
    <Stop>
      <Match AccountId="$(EVERYONE_GROUP_NAME)"></Match>
    </Stop>
  </Rule>

  <Rule Description="Provide access to sound settings" ResourceIri="$(HKLM)/SND/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(ELEVATED_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
      <Match AccountId="$(EVERYONE_GROUP_NAME)" AuthorizationIds="KEY_READ"></Match>
    </Authorize>
    <Stop>
      <Match AccountId="$(EVERYONE_GROUP_NAME)"></Match>
    </Stop>
  </Rule>

  <Rule Description="Grant WaveIn API access to standard rights" ResourceIri="$(GLOBAL_RESOURCES)/WAVEAPI/WAVEIN" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(STANDARD_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="GENERIC_ALL"></Match>
    </Authorize>
  </Rule>

  <Rule Description="Provide access to Audio Routing Manager properties" ResourceIri="$(GLOBAL_RESOURCES)/AUDIORTGMGR/PROPERTIES" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(ELEVATED_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="GENERIC_READ, GENERIC_WRITE"></Match>
      <Match AccountId="$(STANDARD_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="GENERIC_READ"></Match>
    </Authorize>
  </Rule>

  <!-- Low priority rules -->

</CeSecurityPolicyFile>
