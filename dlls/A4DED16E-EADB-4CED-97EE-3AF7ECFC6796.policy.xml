<?xml version="1.0" encoding="utf-8"?>
<!--
Copyright (c) Microsoft Corporation.  All rights reserved.
-->
<CeSecurityPolicyFile Description="sqmevent: Wlan Service policy definitions and rules;" Vendor="Microsoft" RequiredOSVersion="7.00" FileVersion="7.00" xmlns="urn:Microsoft.PlatformBuilder/CeSecurityPolicy">


  <!-- Run sqmevent.exe in an IS chamber -->
  
<!--Begin Generated accounts and routing/authz rules for S-1-5-112-0-0X11-0X00000005 -->
<Macro Id="SQMEVENT_EXE_SID" Value="S-1-5-112-0-0X11-0X00000005" />
<Account Id="$(SQMEVENT_EXE_SID)" FriendlyName="sqmevent.exe" Description="Autogenerated chamber for sqmevent.exe" Type="User">
<MemberOfGroup GroupAccountId="$(SELF_ISOLATED_ELEVATED_RIGHTS_CHAMBER_GROUP_NAME)" />
</Account>
<!--Begin Generated routing/authz rules for sqmevent.exe -->
<Rule Description="Route sqmevent.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/SQMEVENT.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(SQMEVENT_EXE_SID)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize sqmevent.exe be loadable to $(SQMEVENT_EXE_SID) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/SQMEVENT.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(SQMEVENT_EXE_SID)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for sqmevent.exe -->
<!--End Generated accounts and routing/authz rules for S-1-5-112-0-0X11-0X00000005 -->


  
<!--Begin Generated accounts and routing/authz rules for S-1-5-112-0-0X11-0X00000006 -->
<Macro Id="ONBOOTSQM_EXE_SID" Value="S-1-5-112-0-0X11-0X00000006" />
<Account Id="$(ONBOOTSQM_EXE_SID)" FriendlyName="OnBootSqm.exe" Description="Autogenerated chamber for OnBootSqm.exe" Type="User">
<MemberOfGroup GroupAccountId="$(SELF_ISOLATED_ELEVATED_RIGHTS_CHAMBER_GROUP_NAME)" />
</Account>
<!--Begin Generated routing/authz rules for OnBootSqm.exe -->
<Rule Description="Route OnBootSqm.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/ONBOOTSQM.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(ONBOOTSQM_EXE_SID)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize OnBootSqm.exe be loadable to $(ONBOOTSQM_EXE_SID) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/ONBOOTSQM.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(ONBOOTSQM_EXE_SID)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for OnBootSqm.exe -->
<!--End Generated accounts and routing/authz rules for S-1-5-112-0-0X11-0X00000006 -->


  <Rule Description="SQM device policy rule (allow only Standard or higher)" ResourceIri="$(DEVICEMANAGER_DEVICE)/SQM/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(EVERYONE_GROUP_NAME)" AuthorizationIds="ALL_ACCESS"></Match>
    </Authorize>
  </Rule>


  <Rule Description="Allow all signed apps to access SQM files" ResourceIri="$(WINDOWS_DIRECTORY_PATH)/SQM/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(STANDARD_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
    </Authorize>
    <Stop>
      <Match AccountId="$(EVERYONE_GROUP_NAME)"></Match>
    </Stop>
  </Rule>

  <Rule Description="Protecting SQM reg keys" ResourceIri="$(HKLM)/SYSTEM/SQM/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(ELEVATED_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
      <Match AccountId="$(EVERYONE_GROUP_NAME)" AuthorizationIds="KEY_READ"></Match>
    </Authorize>
    <Stop>
      <Match AccountId="$(EVERYONE_GROUP_NAME)"></Match>
    </Stop>
  </Rule>

</CeSecurityPolicyFile>
