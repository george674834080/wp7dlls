<?xml version="1.0" encoding="utf-8"?>
<!--
Copyright (c) Microsoft Corporation.  All rights reserved.
-->
<CeSecurityPolicyFile Description="Specifies policies for Websearch" Vendor="Microsoft" RequiredOSVersion="7.00" FileVersion="7.4.9876" xmlns="urn:Microsoft.PlatformBuilder/CeSecurityPolicy">

  <!--=====================================================================-->
  <!--============================= SM Settings ===========================-->
  <!--=====================================================================-->
  
  
<!--Begin Generated accounts and routing/authz rules for S-1-5-112-0-0x20-0x0000002A -->
<Macro Id="SMSETTINGS_EXE_SID" Value="S-1-5-112-0-0x20-0x0000002A" />
<Account Id="$(SMSETTINGS_EXE_SID)" FriendlyName="smsettings.exe" Description="Autogenerated chamber for smsettings.exe" Type="User">
<MemberOfGroup GroupAccountId="$(STANDARD_RIGHTS_CHAMBER_GROUP_NAME)" />
</Account>
<!--Begin Generated routing/authz rules for smsettings.exe -->
<Rule Description="Route smsettings.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/SMSETTINGS.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(SMSETTINGS_EXE_SID)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize smsettings.exe be loadable to $(SMSETTINGS_EXE_SID) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/SMSETTINGS.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(SMSETTINGS_EXE_SID)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for smsettings.exe -->
<!--End Generated accounts and routing/authz rules for S-1-5-112-0-0x20-0x0000002A -->


  <!-- Rules for registry -->

  <Rule Description="Grant smsettings access to protected registry keys" ResourceIri="$(HKLM)/System/SearchMaps/Configuration/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(SMSETTINGS_EXE_SID)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
    </Authorize>
  </Rule>

  <!--=====================================================================-->
  <!--============================== Websearch ============================-->
  <!--=====================================================================-->

  
<!--Begin Generated accounts and routing/authz rules for S-1-5-112-0-0X20-0X00000028 -->
<Macro Id="WEBSEARCH_EXE_SID" Value="S-1-5-112-0-0X20-0X00000028" />
<Account Id="$(WEBSEARCH_EXE_SID)" FriendlyName="Websearch.exe" Description="Autogenerated chamber for Websearch.exe" Type="User">
<MemberOfGroup GroupAccountId="$(STANDARD_RIGHTS_CHAMBER_GROUP_NAME)" />
</Account>
<!--Begin Generated routing/authz rules for Websearch.exe -->
<Rule Description="Route Websearch.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/WEBSEARCH.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(WEBSEARCH_EXE_SID)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize Websearch.exe be loadable to $(WEBSEARCH_EXE_SID) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/WEBSEARCH.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(WEBSEARCH_EXE_SID)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for Websearch.exe -->
<!--End Generated accounts and routing/authz rules for S-1-5-112-0-0X20-0X00000028 -->


  <!-- Rules for files -->
  <Rule Description="Protect Search directory" ResourceIri="$(FILESYS_PRIMARY_ROOT)/APPLICATION%20DATA/Search/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(ELEVATED_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
      <Match AccountId="$(WEBSEARCH_EXE_SID)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
    </Authorize>
    <Stop>
      <Match AccountId="$(EVERYONE_GROUP_NAME)"></Match>
    </Stop>
  </Rule>

  <Rule Description="Protect Maps directory" ResourceIri="$(FILESYS_PRIMARY_ROOT)/APPLICATION%20DATA/Maps/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(ELEVATED_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
      <Match AccountId="$(WEBSEARCH_EXE_SID)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
      <Match AccountId="$(SMSETTINGS_EXE_SID)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
    </Authorize>
    <Stop>
      <Match AccountId="$(EVERYONE_GROUP_NAME)"></Match>
    </Stop>
  </Rule>

  <Rule Description="Protect POIs directory" ResourceIri="$(FILESYS_PRIMARY_ROOT)/APPLICATION%20DATA/Pois/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(ELEVATED_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
      <Match AccountId="$(WEBSEARCH_EXE_SID)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
      <Match AccountId="$(OM_USER_NAME)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
      <Match AccountId="$(SID_MTF_SERVER)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
    </Authorize>
    <Stop>
      <Match AccountId="$(EVERYONE_GROUP_NAME)"></Match>
    </Stop>
  </Rule>
    
  <!-- Rules for registry -->
  <Rule Description="Grant Search app access to protected registry keys for home image" ResourceIri="$(HKLM)/SYSTEM/SEARCH/HomeImage/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(WEBSEARCH_EXE_SID)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
    </Authorize>
  </Rule>

  <Rule Description="Grant Search app access to protected registry keys for client configuration" ResourceIri="$(HKLM)/SYSTEM/SEARCH/ClientConfiguration/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(WEBSEARCH_EXE_SID)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
    </Authorize>
  </Rule>

  <Rule Description="Grant Search app access to top level values" ResourceIri="$(HKLM)/SYSTEM/SEARCH" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(WEBSEARCH_EXE_SID)" AuthorizationIds="KEY_WRITE"></Match>
    </Authorize>
  </Rule>

  <Rule Description="Grant websearch access to protected registry keys for location access" ResourceIri="$(HKLM)/System/SearchMaps/Configuration/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(WEBSEARCH_EXE_SID)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
    </Authorize>
  </Rule>

  <Rule Description="Grant webserach access to protected registry keys for device info" ResourceIri="$(HKLM)/System/Platform/DeviceTargetingInfo/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(WEBSEARCH_EXE_SID)" AuthorizationIds="KEY_READ"></Match>
    </Authorize>
  </Rule>

  <Rule Description="Grant Maps access to protected registry keys for generation id" ResourceIri="$(HKLM)/System/Maps/Providers/Tiles" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(WEBSEARCH_EXE_SID)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
    </Authorize>
  </Rule>

  <Rule Description="Grant Maps access to protected registry keys for Venue Map service updates" ResourceIri="$(HKLM)/System/Maps/Providers/VenueMap" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(WEBSEARCH_EXE_SID)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
    </Authorize>
  </Rule>

  <Rule Description="Grant Search app access to top level values" ResourceIri="$(HKLM)/SYSTEM/Maps" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(WEBSEARCH_EXE_SID)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
    </Authorize>
  </Rule>

  <Rule Description="Grant websearch access to protected registry keys for current language" ResourceIri="$(HKCU)/Software/Microsoft/Internet%20Explorer/International/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(WEBSEARCH_EXE_SID)" AuthorizationIds="KEY_READ"></Match>
    </Authorize>
  </Rule>

  <Rule Description="Grant websearch access to the Accelerometer for stability" ResourceIri="$(DEVICEMANAGER_DEVICE)/ACC/1" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(WEBSEARCH_EXE_SID)" AuthorizationIds="ALL_ACCESS"></Match>
    </Authorize>
  </Rule>


</CeSecurityPolicyFile>
