<?xml version="1.0" encoding="utf-8"?>
<!--
Copyright (c) Microsoft Corporation.  All rights reserved.
-->
<CeSecurityPolicyFile Description="Office security policy" Vendor="Microsoft" RequiredOSVersion="7.00" FileVersion="7.4.9876" xmlns="urn:Microsoft.PlatformBuilder/CeSecurityPolicy">
 
  <!-- The "Office Mobile" account -->
  <!-- "Office Mobile" Chamber has to be created irrespective of whether it's 
  available in image -->

  
<!--Begin Generated accounts and routing/authz rules for S-1-5-112-0-0X20-0X00000009 -->
<Macro Id="OFFICE_MOBILE_CHAMBER" Value="S-1-5-112-0-0X20-0X00000009" />
<Account Id="$(OFFICE_MOBILE_CHAMBER)" FriendlyName="Office Mobile Chamber" Description="Autogenerated chamber for Office Mobile Chamber" Type="User">
<MemberOfGroup GroupAccountId="$(SELF_ISOLATED_STANDARD_RIGHTS_CHAMBER_GROUP_NAME)" />
</Account>
<!--Begin Generated routing/authz rules for pword.exe -->
<Rule Description="Route pword.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/PWORD.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize pword.exe be loadable to $(OFFICE_MOBILE_CHAMBER) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/PWORD.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for pword.exe -->

<!--Begin Generated routing/authz rules for pxl.exe -->
<Rule Description="Route pxl.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/PXL.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize pxl.exe be loadable to $(OFFICE_MOBILE_CHAMBER) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/PXL.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for pxl.exe -->

<!--Begin Generated routing/authz rules for ppt.exe -->
<Rule Description="Route ppt.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/PPT.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize ppt.exe be loadable to $(OFFICE_MOBILE_CHAMBER) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/PPT.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for ppt.exe -->

<!--Begin Generated routing/authz rules for onenotemobile.exe -->
<Rule Description="Route onenotemobile.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/ONENOTEMOBILE.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize onenotemobile.exe be loadable to $(OFFICE_MOBILE_CHAMBER) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/ONENOTEMOBILE.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for onenotemobile.exe -->

<!--Begin Generated routing/authz rules for MyOffice.exe -->
<Rule Description="Route MyOffice.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/MYOFFICE.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize MyOffice.exe be loadable to $(OFFICE_MOBILE_CHAMBER) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/MYOFFICE.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for MyOffice.exe -->

<!--Begin Generated routing/authz rules for OfficeSettings.exe -->
<Rule Description="Route OfficeSettings.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/OFFICESETTINGS.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize OfficeSettings.exe be loadable to $(OFFICE_MOBILE_CHAMBER) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/OFFICESETTINGS.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for OfficeSettings.exe -->

<!--Begin Generated routing/authz rules for zipview.exe -->
<Rule Description="Route zipview.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/ZIPVIEW.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize zipview.exe be loadable to $(OFFICE_MOBILE_CHAMBER) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/ZIPVIEW.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for zipview.exe -->

<!--Begin Generated routing/authz rules for OfficeURL.exe -->
<Rule Description="Route OfficeURL.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/OFFICEURL.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize OfficeURL.exe be loadable to $(OFFICE_MOBILE_CHAMBER) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/OFFICEURL.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for OfficeURL.exe -->

<!--Begin Generated routing/authz rules for OfficeNoUIURL.exe -->
<Rule Description="Route OfficeNoUIURL.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/OFFICENOUIURL.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize OfficeNoUIURL.exe be loadable to $(OFFICE_MOBILE_CHAMBER) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/OFFICENOUIURL.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for OfficeNoUIURL.exe -->
<!--End Generated accounts and routing/authz rules for S-1-5-112-0-0X20-0X00000009 -->


  <!-- ""\Application Data\Microsoft\Office Mobile" is protected because data from Corpnet Servers are cached into this folder -->
  <Rule Action="CreateNew" Description="Protect the Office Mobile Temporary directory" ResourceIri="$(FILESYS_PRIMARY_ROOT)/APPLICATION%20DATA/MICROSOFT/OFFICE%20MOBILE/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match Action="Add" AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
    </Authorize>
    <Stop>
      <Match AccountId="$(EVERYONE_GROUP_NAME)"></Match>
    </Stop>
  </Rule>

  <!-- ""\Application Data\Volatile\Office Mobile" is protected because data from Corpnet Servers are placed into this folder before opening -->
  <Rule Action="CreateNew" Description="Protect the Office Mobile Temporary directory under volatile" ResourceIri="$(FILESYS_PRIMARY_ROOT)/APPLICATION%20DATA/VOLATILE/OFFICE%20MOBILE/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match Action="Add" AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
      <Match Action="Add" AccountId="$(OM_USER_NAME)" AuthorizationIds="FILE_GENERIC_READ"></Match>
      <Match Action="Add" AccountId="$(ELEVATED_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
    </Authorize>
    <Stop>
      <Match AccountId="$(EVERYONE_GROUP_NAME)"></Match>
    </Stop>
  </Rule>

  <!-- Protecting "HKLM/SOFTWARE/MICROSOFT/OFFICE%20MOBILE" registry keys. 
            This is because we put important info like: UserAgent name which defines the protocol with IAG server. 
  -->
  <Rule Action="CreateNew" Description="Protect the Office Mobile Registry keys" ResourceIri="$(HKLM)/SOFTWARE/MICROSOFT/OFFICE%20MOBILE/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_HIGH">
    <Authorize>
      <Match Action="Add" AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
      <Match Action="Add" AccountId="$(OM_USER_NAME)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
      <Match Action="Add" AccountId="$(ELEVATED_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
    </Authorize>
    <Stop>
      <Match AccountId="$(EVERYONE_GROUP_NAME)"></Match>
    </Stop>
  </Rule>
    
  <Rule Action="CreateNew" Description="Give the process in Office Mobile chamber shared access to read and write credentials owned by Outlook Mobile chamber" ResourceIri="policy:/RESOURCES/CREDMAN/PRIVATE/$(OM_USER_NAME)/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match Action="Add" AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="GENERIC_READ, GENERIC_WRITE"></Match>
    </Authorize>
  </Rule>

  <Rule Action="CreateNew" Description="Give the process in Outlook Mobile chamber shared access to read and write credentials owned by Office Mobile chamber" ResourceIri="policy:/RESOURCES/CREDMAN/PRIVATE/$(OFFICE_MOBILE_CHAMBER)/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match Action="Add" AccountId="$(OM_USER_NAME)" AuthorizationIds="GENERIC_READ, GENERIC_WRITE"></Match>
    </Authorize>
  </Rule>


  <!-- Protecting SQLCE runtime objects that are created in GLOBAL namespace similar to that of the database file path rule above -->
  <Rule Action="CreateNew" Description="Grant access only to chambers that can access the database file hierarchy.sdf to read or write corresponding mapfile and mutex objects" ResourceIri="policy:/KERNEL/(+)/GLOBAL/SQL/APPLICATION%20DATA/MICROSOFT/OFFICE%20MOBILE/ONENOTE%20MOBILE/V14/META/HIERARCHY.SDF/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match Action="Add" AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="ALL_ACCESS"></Match>
    </Authorize>
    <Stop>
      <Match AccountId="$(EVERYONE_GROUP_NAME)"></Match>
    </Stop>
  </Rule>

  <Rule Action="CreateNew" Description="Grant access only to chambers that can access the database file spsqlstore.sdf to read or write corresponding mapfile and mutex objects" ResourceIri="policy:/KERNEL/(+)/GLOBAL/SQL/APPLICATION%20DATA/MICROSOFT/OFFICE%20MOBILE/SPM%20DATA/SPSQLSTORE.SDF/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match Action="Add" AccountId="$(OFFICE_MOBILE_CHAMBER)" AuthorizationIds="ALL_ACCESS"></Match>
      <Match Action="Add" AccountId="$(OM_USER_NAME)" AuthorizationIds="ALL_ACCESS"></Match>
    </Authorize>
    <Stop>
      <Match AccountId="$(EVERYONE_GROUP_NAME)"></Match>
    </Stop>
  </Rule>

  <!-- "\Application Data\Microsoft\Office Mobile\SPM Data\SPSQLSTORE.sdf" is accessible from outlook chamber as well. -->
  <!-- The priority should be same as that for the corresponding rule for Office Mobile chamber. -->
  <Rule Action="CreateNew" Description="Protect the Office Mobile Temporary directory" ResourceIri="$(FILESYS_PRIMARY_ROOT)/APPLICATION%20DATA/MICROSOFT/OFFICE%20MOBILE/SPM%20Data/SPSQLSTORE.SDF" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match Action="Add" AccountId="$(OM_USER_NAME)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
    </Authorize>
  </Rule>

  <!-- "\Application Data\Microsoft\Office Mobile\SPM Data\AAM.edb" is accessible from outlook chamber as well. -->
  <!-- The priority should be same as that for the corresponding rule for Office Mobile chamber. -->
  <Rule Action="CreateNew" Description="Protect the Office Mobile Temporary directory" ResourceIri="$(FILESYS_PRIMARY_ROOT)/APPLICATION%20DATA/MICROSOFT/OFFICE%20MOBILE/AAM.EDB" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match Action="Add" AccountId="$(OM_USER_NAME)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
    </Authorize>
  </Rule>


  <!-- "\Application Data\Microsoft\Office Mobile\SPM Data\UnSupported.edb" is accessible from outlook chamber as well. -->
  <!-- The priority should be same as that for the corresponding rule for Office Mobile chamber. -->
  <Rule Action="CreateNew" Description="Protect the Office Mobile Temporary directory" ResourceIri="$(FILESYS_PRIMARY_ROOT)/APPLICATION%20DATA/MICROSOFT/OFFICE%20MOBILE/NONSUPPORTED.EDB" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match Action="Add" AccountId="$(OM_USER_NAME)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
    </Authorize>
  </Rule>

  <!-- "\Application Data\Microsoft\Office Mobile" is accessible from outlook chamber as well. -->
  <Rule Action="CreateNew" Description="Provide Outlook chamber access to the FileStore directory" ResourceIri="$(FILESYS_PRIMARY_ROOT)/APPLICATION%20DATA/MICROSOFT/OFFICE%20MOBILE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match Action="Add" AccountId="$(OM_USER_NAME)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
    </Authorize>
  </Rule>

  <!-- "\Application Data\Microsoft\Office Mobile\SPM Data" is accessible from outlook chamber as well. -->
  <Rule Action="CreateNew" Description="Provide Outlook chamber access to the FileStore directory" ResourceIri="$(FILESYS_PRIMARY_ROOT)/APPLICATION%20DATA/MICROSOFT/OFFICE%20MOBILE/SPM%20Data" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match Action="Add" AccountId="$(OM_USER_NAME)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
    </Authorize>
  </Rule>

  <!-- "\Application Data\Microsoft\Office Mobile\SPM Data\File Store" is    -->
  <!-- accessible from Outlook chamber as we try to create FileStore during -->
  <!-- SPSyncCore initialization.                                           -->
  <Rule Action="CreateNew" Description="Provide Outlook chamber access to the FileStore directory" ResourceIri="$(FILESYS_PRIMARY_ROOT)/APPLICATION%20DATA/MICROSOFT/OFFICE%20MOBILE/SPM%20Data/FILE%20STORE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match Action="Add" AccountId="$(OM_USER_NAME)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
    </Authorize>
  </Rule>

  
</CeSecurityPolicyFile>
