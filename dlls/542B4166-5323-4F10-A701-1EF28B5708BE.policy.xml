<?xml version="1.0" encoding="utf-8"?>
<!--
Copyright (c) Microsoft Corporation.  All rights reserved.
-->
<!--
Use of this source code is subject to the terms of the Microsoft
premium shared source license agreement under which you licensed
this source code. If you did not accept the terms of the license
agreement, you are not authorized to use this source code.
For the terms of the license, please see the license agreement
signed by you and Microsoft.
THE SOURCE CODE IS PROVIDED "AS IS", WITH NO WARRANTIES OR INDEMNITIES.
-->
<CeSecurityPolicyFile Description="cprog: CPROG security policy;" Vendor="Microsoft" RequiredOSVersion="7.00" FileVersion="7.00" xmlns="urn:Microsoft.PlatformBuilder/CeSecurityPolicy">  
<!-- CPROG security policy -->
    <Rule Description="Allows trusted access to phone Dial API" ResourceIri="$(GLOBAL_RESOURCES)/CPROG/PHONEDIALAPI-TRUSTED" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
        <Match AccountId="$(ELEVATED_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="GENERIC_ALL"></Match>
        </Authorize>
    </Rule>

    <Rule Description="Allows normal access to phone Dial API - does not allow use of PH_CALLFLAGS_TRUSTED" ResourceIri="$(GLOBAL_RESOURCES)/CPROG/PHONEDIALAPI-NORMAL" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
        <Match AccountId="$(OM_USER_NAME)" AuthorizationIds="GENERIC_ALL"></Match>
        <Match AccountId="$(STANDARD_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="GENERIC_ALL"></Match>
        </Authorize>
    </Rule>

    
<!--Begin Generated accounts and routing/authz rules for S-1-5-112-0-0X10-0X00000005 -->
<Macro Id="CPROG_EXE_SID" Value="S-1-5-112-0-0X10-0X00000005" />
<Account Id="$(CPROG_EXE_SID)" FriendlyName="cprog.exe" Description="Autogenerated chamber for cprog.exe" Type="User">
<MemberOfGroup GroupAccountId="$(ELEVATED_RIGHTS_CHAMBER_GROUP_NAME)" />
</Account>
<!--Begin Generated routing/authz rules for cprog.exe -->
<Rule Description="Route cprog.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/CPROG.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(CPROG_EXE_SID)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize cprog.exe be loadable to $(CPROG_EXE_SID) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/CPROG.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(CPROG_EXE_SID)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for cprog.exe -->
<!--End Generated accounts and routing/authz rules for S-1-5-112-0-0X10-0X00000005 -->


<!-- CHDIALERHOST security policy -->
   
<!--Begin Generated accounts and routing/authz rules for S-1-5-112-0-0X20-0X00000027 -->
<Macro Id="CHDIALERHOST_EXE_SID" Value="S-1-5-112-0-0X20-0X00000027" />
<Account Id="$(CHDIALERHOST_EXE_SID)" FriendlyName="chdialerhost.exe" Description="Autogenerated chamber for chdialerhost.exe" Type="User">
<MemberOfGroup GroupAccountId="$(STANDARD_RIGHTS_CHAMBER_GROUP_NAME)" />
</Account>
<!--Begin Generated routing/authz rules for chdialerhost.exe -->
<Rule Description="Route chdialerhost.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/CHDIALERHOST.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(CHDIALERHOST_EXE_SID)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize chdialerhost.exe be loadable to $(CHDIALERHOST_EXE_SID) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/CHDIALERHOST.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(CHDIALERHOST_EXE_SID)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for chdialerhost.exe -->
<!--End Generated accounts and routing/authz rules for S-1-5-112-0-0X20-0X00000027 -->


    <Rule Action="CreateOrReplace" Description="Allows trusted access to phone Dial API" ResourceIri="$(GLOBAL_RESOURCES)/CPROG/PHONEDIALAPI-TRUSTED" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
        <Match Action="Add" AccountId="$(CHDIALERHOST_EXE_SID)" AuthorizationIds="GENERIC_ALL"></Match>
        </Authorize>
    </Rule>

    <Rule Action="CreateOrReplace" Description="Allow trusted access to SIM files for voicemail" ResourceIri="$(CCA_SIM_FILE)/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
        <Match Action="Add" AccountId="$(CHDIALERHOST_EXE_SID)" AuthorizationIds="GENERIC_READ"></Match>
        </Authorize>
    </Rule>
    
    <Rule Action="CreateOrReplace" Description="Allow trusted access to SIM PIN" ResourceIri="$(CCA_SIM_PIN)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
        <Match Action="Add" AccountId="$(CHDIALERHOST_EXE_SID)" AuthorizationIds="GENERIC_READ,GENERIC_WRITE,GENERIC_EXECUTE"></Match>
        </Authorize>
    </Rule>
    
    <Rule Action="CreateOrReplace" Description="Grant access to registry keys of Phone State" ResourceIri="$(HKCU)/SYSTEM/STATE/PHONE/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
        <Match Action="Add" AccountId="$(CHDIALERHOST_EXE_SID)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
        </Authorize>
    </Rule>
    
    <Rule Action="CreateOrReplace" Description="Grant access to registry keys of Phone State" ResourceIri="$(HKLM)/SYSTEM/STATE/PHONE/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
        <Match Action="Add" AccountId="$(CHDIALERHOST_EXE_SID)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
        </Authorize>
    </Rule>   

    <Rule Action="CreateOrReplace" Description="Grant access to Audio Routing Manager (for Speakerphone)" ResourceIri="$(GLOBAL_RESOURCES)/AUDIORTGMGR/PROPERTIES" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
        <Match Action="Add" AccountId="$(CHDIALERHOST_EXE_SID)" AuthorizationIds="GENERIC_READ, GENERIC_WRITE"></Match>
        </Authorize>
    </Rule>   

   <Rule Description="The contacts configuration shouldn't be allowed to be modified by apps running in normal group" ResourceIri="$(HKLM)/SOFTWARE/MICROSOFT/VISUALVOICEMAIL/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_HIGH">
    <Authorize>
      <Match Action="Add" AccountId="$(CHDIALERHOST_EXE_SID)" AuthorizationIds="KEY_READ"></Match>
      <Match Action="Add" AccountId="$(ELEVATED_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
    </Authorize>
  </Rule>

    <Rule Action="CreateNew" Description="RPC server interface for the Sync app " ResourceIri="$(RPC_CLIENT_INTERFACE)/0c53aa2e-fb1c-49c5-bfb6-c54f8e5857cd/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
        <Match Action="Add" AccountId="$(CHDIALERHOST_EXE_SID)" AuthorizationIds="GENERIC_ALL"></Match>
        </Authorize>
    </Rule>

<!-- CallSettingsHost security policy -->
   
<!--Begin Generated accounts and routing/authz rules for S-1-5-112-0-0X20-0X00000029 -->
<Macro Id="CALLSETTINGSHOST_EXE_SID" Value="S-1-5-112-0-0X20-0X00000029" />
<Account Id="$(CALLSETTINGSHOST_EXE_SID)" FriendlyName="callsettingshost.exe" Description="Autogenerated chamber for callsettingshost.exe" Type="User">
<MemberOfGroup GroupAccountId="$(STANDARD_RIGHTS_CHAMBER_GROUP_NAME)" />
</Account>
<!--Begin Generated routing/authz rules for callsettingshost.exe -->
<Rule Description="Route callsettingshost.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/CALLSETTINGSHOST.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(CALLSETTINGSHOST_EXE_SID)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize callsettingshost.exe be loadable to $(CALLSETTINGSHOST_EXE_SID) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/CALLSETTINGSHOST.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(CALLSETTINGSHOST_EXE_SID)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for callsettingshost.exe -->
<!--End Generated accounts and routing/authz rules for S-1-5-112-0-0X20-0X00000029 -->


    <Rule Action="CreateOrReplace" Description="Allow trusted access to SIM files for voicemail" ResourceIri="$(CCA_SIM_FILE)/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
        <Match Action="Add" AccountId="$(CALLSETTINGSHOST_EXE_SID)" AuthorizationIds="GENERIC_READ,GENERIC_WRITE"></Match>
        </Authorize>
    </Rule>
    
    <Rule Action="CreateOrReplace" Description="Allow trusted access to SIM PIN" ResourceIri="$(CCA_SIM_PIN)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
        <Match Action="Add" AccountId="$(CALLSETTINGSHOST_EXE_SID)" AuthorizationIds="GENERIC_READ,GENERIC_WRITE,GENERIC_EXECUTE"></Match>
        </Authorize>
    </Rule>

    <Rule Action="CreateOrReplace" Description="Allow trusted access to RIL driver" ResourceIri="$(DEVICEMANAGER_DEVICE)/RIL/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
        <Match Action="Add" AccountId="$(CALLSETTINGSHOST_EXE_SID)" AuthorizationIds="ALL_ACCESS"></Match>
        </Authorize>
    </Rule>

    <Rule Action="CreateOrReplace" Description="Allow trusted access to RIL" ResourceIri="$(CCA_RIL)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
        <Match Action="Add" AccountId="$(CALLSETTINGSHOST_EXE_SID)" AuthorizationIds="GENERIC_EXECUTE"></Match>
        </Authorize>
    </Rule>

    <Rule Action="CreateOrReplace" Description="Grant access to registry keys of Phone State" ResourceIri="$(HKLM)/SYSTEM/STATE/LKGSETTING/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
        <Match Action="Add" AccountId="$(CALLSETTINGSHOST_EXE_SID)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
        </Authorize>
    </Rule>

    <Rule Action="CreateOrReplace" Description="Grant access to the call forwarding statstore registry key" ResourceIri="$(HKLM)/SYSTEM/STATE/PHONE/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
        <Match Action="Add" AccountId="$(CALLSETTINGSHOST_EXE_SID)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
        </Authorize>
    </Rule>

    <Rule Action="CreateOrReplace" Description="This rule is to allow call settings to update call forwarding thru cprog. We are using the phone dial api normal rule here because any app that has this permission can essentially update the call forwarding setting by executing PhoneDial with the correct dial code" ResourceIri="$(GLOBAL_RESOURCES)/CPROG/PHONEDIALAPI-NORMAL" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
        <Match Action="Add" AccountId="$(CALLSETTINGSHOST_EXE_SID)" AuthorizationIds="GENERIC_ALL"></Match>
        </Authorize>
    </Rule>
    
    <!-- Lock down pim.vol -->
    <Rule Action="CreateOrReplace" Description="Applications in the normal group can access pim.vol" ResourceIri="$(FILESYS_PRIMARY_ROOT)/APPLICATION%20DATA/MICROSOFT/PIM.VOL" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
            <Match Action="Add" AccountId="$(STANDARD_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="FILE_ALL_ACCESS"></Match>
        </Authorize>
        <Stop>
            <Match AccountId="$(EVERYONE_GROUP_NAME)"></Match>
        </Stop>
    </Rule>
  
    <Rule Action="CreateNew" Description="RPC server interface for the Sync app " ResourceIri="$(RPC_CLIENT_INTERFACE)/0c53aa2e-fb1c-49c5-bfb6-c54f8e5857cd/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
      <Authorize>
        <Match Action="Add" AccountId="$(CALLSETTINGSHOST_EXE_SID)" AuthorizationIds="GENERIC_ALL"></Match>
      </Authorize>
    </Rule>

  <!-- Field Test App security policy -->
  
<!--Begin Generated accounts and routing/authz rules for S-1-5-112-0-0X11-0X00000030 -->
<Macro Id="FIELDTESTAPP_EXE_SID" Value="S-1-5-112-0-0X11-0X00000030" />
<Account Id="$(FIELDTESTAPP_EXE_SID)" FriendlyName="fieldtestapp.exe" Description="Autogenerated chamber for fieldtestapp.exe" Type="User">
<MemberOfGroup GroupAccountId="$(SELF_ISOLATED_ELEVATED_RIGHTS_CHAMBER_GROUP_NAME)" />
</Account>
<!--Begin Generated routing/authz rules for fieldtestapp.exe -->
<Rule Description="Route fieldtestapp.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/FIELDTESTAPP.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(FIELDTESTAPP_EXE_SID)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize fieldtestapp.exe be loadable to $(FIELDTESTAPP_EXE_SID) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/FIELDTESTAPP.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(FIELDTESTAPP_EXE_SID)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for fieldtestapp.exe -->
<!--End Generated accounts and routing/authz rules for S-1-5-112-0-0X11-0X00000030 -->


  <Rule Action="CreateOrReplace" Description="Allow trusted access to RIL driver" ResourceIri="$(DEVICEMANAGER_DEVICE)/RIL/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match Action="Add" AccountId="$(FIELDTESTAPP_EXE_SID)" AuthorizationIds="ALL_ACCESS"></Match>
    </Authorize>
  </Rule>

  <Rule Action="CreateOrReplace" Description="Allow trusted access to RIL" ResourceIri="$(CCA_RIL)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match Action="Add" AccountId="$(FIELDTESTAPP_EXE_SID)" AuthorizationIds="GENERIC_EXECUTE"></Match>
    </Authorize>
  </Rule>

  <Rule Action="CreateOrReplace" Description="Allow trusted access to cellular network" ResourceIri="$(CCA_NETWORK)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match Action="Add" AccountId="$(FIELDTESTAPP_EXE_SID)" AuthorizationIds="GENERIC_EXECUTE"></Match>
    </Authorize>
  </Rule>

</CeSecurityPolicyFile>
