<?xml version="1.0" encoding="utf-8"?>
<!--
Copyright (c) Microsoft Corporation.  All rights reserved.
-->
<!--
Use of this source code is subject to the terms of the Microsoft
premium shared source license agreement under which you licensed
this source code. If you did not accept the terms of the license
agreement, you are not authorized to use this source code.
For the terms of the license, please see the license agreement
signed by you and Microsoft.
THE SOURCE CODE IS PROVIDED "AS IS", WITH NO WARRANTIES OR INDEMNITIES.
-->
<CeSecurityPolicyFile Description="Skybox for Windows Mobile Security Policy" Vendor="Microsoft" RequiredOSVersion="7.00" FileVersion="7.4.9876" xmlns="urn:Microsoft.PlatformBuilder/CeSecurityPolicy">
    
    
<!--Begin Generated accounts and routing/authz rules for S-1-5-112-0-0X11-0X0000004C -->
<Macro Id="MYPHONE_ACCOUNT_ID" Value="S-1-5-112-0-0X11-0X0000004C" />
<Account Id="$(MYPHONE_ACCOUNT_ID)" FriendlyName="Find My Phone Chamber" Description="Autogenerated chamber for Find My Phone Chamber" Type="User">
<MemberOfGroup GroupAccountId="$(SELF_ISOLATED_ELEVATED_RIGHTS_CHAMBER_GROUP_NAME)" />
</Account>
<!--Begin Generated routing/authz rules for MyPhoneTasksRuntime.exe -->
<Rule Description="Route MyPhoneTasksRuntime.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/MYPHONETASKSRUNTIME.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(MYPHONE_ACCOUNT_ID)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize MyPhoneTasksRuntime.exe be loadable to $(MYPHONE_ACCOUNT_ID) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/MYPHONETASKSRUNTIME.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(MYPHONE_ACCOUNT_ID)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for MyPhoneTasksRuntime.exe -->

<!--Begin Generated routing/authz rules for MyPhoneCPL.exe -->
<Rule Description="Route MyPhoneCPL.exe" ResourceIri="$(LOADERVERIFIER_ROUTE_BY_NAME)/PRIMARY/WINDOWS/MYPHONECPL.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_LOW">
<Authorize>
<Match AccountId="$(MYPHONE_ACCOUNT_ID)" AuthorizationIds="LV_ACCESS_EXECUTE" />
</Authorize>
</Rule>
<Rule Description="Authorize MyPhoneCPL.exe be loadable to $(MYPHONE_ACCOUNT_ID) and  chambers" ResourceIri="$(LOADERVERIFIER_EXE_AUTHZ_INROM_ROOT)/WINDOWS/MYPHONECPL.EXE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(MYPHONE_ACCOUNT_ID)" AuthorizationIds="LV_ACCESS_EXECUTE,LV_ACCESS_LOAD" />
</Authorize>
</Rule>
<!--End Generated routing/authz rules for MyPhoneCPL.exe -->
<!--End Generated accounts and routing/authz rules for S-1-5-112-0-0X11-0X0000004C -->


    <!-- ACL'ing Wipe access -->
    <Rule Description="Grant access to private REMOTEWIPE API" ResourceIri="/METABASE/./VENDOR/MSFT/REMOTEWIPE/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_HIGH">
        <Authorize>
          <Match AccountId="$(MYPHONE_ACCOUNT_ID)" AuthorizationIds="METABASE_ALL"></Match>
        </Authorize>
    </Rule>
  

    <!-- ACL'ing lock access -->
    <Rule Description="Grant access to private LASS APIs" ResourceIri="$(GLOBAL_RESOURCES)/LASS/REMOTE_LOCK" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_HIGH">
        <Authorize>
          <Match AccountId="$(MYPHONE_ACCOUNT_ID)" AuthorizationIds="ALL_ACCESS"></Match>
        </Authorize>
    </Rule>
    
    <!-- My Phone Service Policy for RPC access -->
    
    <!-- MyPhoneTasksRuntime.exe RPC -->
    <Rule Action="CreateNew" Description="Authorize a server to register endpoint name SkyboxTasksRuntimeInterface" ResourceIri="$(RPC_SERVER_ENDPOINT)/SkyboxTasksRuntimeInterface" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
          <Match AccountId="$(MYPHONE_ACCOUNT_ID)" AuthorizationIds="GENERIC_ALL"></Match>
        </Authorize>
        <Stop>
            <Match AccountId="$(EVERYONE_GROUP_NAME)"></Match>
        </Stop>
    </Rule>
    
    <Rule Description="Authorize clients to call into the an interface" ResourceIri="$(RPC_CLIENT_INTERFACE)/39736341-1222-46ca-9cca-0fbce4383a0c/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
        <Match AccountId="$(MYPHONE_ACCOUNT_ID)" AuthorizationIds="GENERIC_ALL"></Match>
          <Match AccountId="$(OM_USER_NAME)" AuthorizationIds="GENERIC_ALL"></Match>
          <Match AccountId="$(SID_UDEVICE_ELEVATED)" AuthorizationIds="GENERIC_ALL"></Match>
          <Match AccountId="$(OOBE_ACCOUNT_ID)" AuthorizationIds="GENERIC_ALL"></Match>
        </Authorize>
    </Rule>

    <Rule Description="Authorize clients to call into the an interface" ResourceIri="$(RPC_CLIENT_INTERFACE)/abc74dea-27c2-4266-b0c3-0d89fec14de1/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
        <Authorize>
        <Match AccountId="$(MYPHONE_ACCOUNT_ID)" AuthorizationIds="GENERIC_ALL"></Match>
        </Authorize>
    </Rule>

    <!-- Registry keys -->
    <Rule Description="Deny access to registry keys" ResourceIri="policy:/REGISTRY/HKLM/SOFTWARE/MICROSOFT/MYPHONE/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_HIGH">
        <Authorize>
            <Match AccountId="$(ELEVATED_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
            <Match AccountId="$(OM_USER_NAME)" AuthorizationIds="KEY_ALL_ACCESS"></Match>
        </Authorize>
        <Stop>
            <Match AccountId="$(EVERYONE_GROUP_NAME)"></Match>
        </Stop>
    </Rule>

</CeSecurityPolicyFile>
