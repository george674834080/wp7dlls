<?xml version="1.0" encoding="utf-8"?>
<!--
Copyright (c) Microsoft Corporation.  All rights reserved.
-->
<CeSecurityPolicyFile Description="BaseDrivers_OS security policy" Vendor="Microsoft" RequiredOSVersion="7.00" FileVersion="7.4.9876" xmlns="urn:Microsoft.PlatformBuilder/CeSecurityPolicy">

  <!--
  Metadata is stored on the device but off to the side - it is not used by the
  policy engine. It is used for validation and reference if more data is imported
  later.
  
  Metadata values can be imported more than once, but all definitions must match.
  It is an error to refer to metadata that is not defined (i.e. use an undefined
  Authorization Id in an ACL).
  -->

<!-- Rules for use with Services Filter -->

  <Rule Description="Elevated can change port(add/close/unbind)" ResourceIri="$(GLOBAL_RESOURCES)/NETFILTER/SERVICE-CONFIGURE" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_HIGH">
    <Authorize>
      <Match AccountId="$(ELEVATED_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="ALL_ACCESS"></Match>
    </Authorize>
  </Rule>

  <!-- Sensors capability -->
  <!-- Grants yamanote apps and in-rom LPC apps access to sensors -->
  <!-- ACC: currently only ACC1 is supported from managed layer. So we'll grant access to them-->
  <!-- In future as other sensors are exposed through managed APIs, this capability should be 
     extended to add access to them -->

  
<!--Begin generating capability accounts and authorization rules for ID_CAP_SENSORS -->
<Macro Id="CAPMACRO_ID_CAP_SENSORS" Value="S-1-5-112-0-0X70-0X49445F4341505F53454E534F5253" />
<Account Id="$(CAPMACRO_ID_CAP_SENSORS)" FriendlyName="ID_CAP_SENSORS:Capability to access sensors from yamanote apps and in-rom LPC apps" Description="Autogenerated group for capability ID_CAP_SENSORS" Type="Group">
<MemberOfGroup GroupAccountId="$(PUBLIC_CAPABILITIES_GROUP_NAME)" />
</Account>
<Rule Description="Authorization rule for capability ID_CAP_SENSORS" ResourceIri="$(DEVICEMANAGER_DEVICE)/ACC/1" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(CAPMACRO_ID_CAP_SENSORS)" AuthorizationIds="ALL_ACCESS" />
</Authorize>
</Rule>
<Rule Description="Authorization rule for capability ID_CAP_SENSORS" ResourceIri="$(DEVICEMANAGER_DEVICE)/GYR/1" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(CAPMACRO_ID_CAP_SENSORS)" AuthorizationIds="ALL_ACCESS" />
</Authorize>
</Rule>
<Rule Description="Authorization rule for capability ID_CAP_SENSORS" ResourceIri="$(DEVICEMANAGER_DEVICE)/CMP/1" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(CAPMACRO_ID_CAP_SENSORS)" AuthorizationIds="ALL_ACCESS" />
</Authorize>
</Rule>
<Rule Description="Authorization rule for capability ID_CAP_SENSORS" ResourceIri="$(DEVICEMANAGER_DEVICE)/FUS/1" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
<Authorize>
<Match AccountId="$(CAPMACRO_ID_CAP_SENSORS)" AuthorizationIds="ALL_ACCESS" />
</Authorize>
</Rule>
<!--End generating capability accounts and authorization rules for ID_CAP_SENSORS -->


  <!-- Rule for keyboard driver -->
  <Rule Description="IClass policy rule for keyboard driver" ResourceIri="$(DEVICEMANAGER_ICLASS)/CBE6DDF2-F5D4-4E16-9F61-4CCC0B6695F3" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Authorize>
      <Match AccountId="$(EVERYONE_GROUP_NAME)" AuthorizationIds="ALL_ACCESS"></Match>
    </Authorize>
  </Rule>

  <Rule Description="Keyboard driver IOCTL Security Policy" ResourceIri="$(GLOBAL_RESOURCES)/KEYBOARD/IOCTL_RESTRICTED" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
    <Stop>
      <Match AccountId="$(EVERYONE_GROUP_NAME)"></Match>
    </Stop>

  </Rule>

  <!-- Rule for battery driver -->
  <Rule Action="CreateNew" Description="Battery driver IOCTL Security Policy" ResourceIri="$(GLOBAL_RESOURCES)/BATTERY/IOCTL_RESTRICTED" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_STANDARD">
      <Authorize>
          <Match Action="Add" AccountId="$(ELEVATED_RIGHTS_RESOURCE_GROUP_NAME)" AuthorizationIds="GENERIC_ALL"></Match>
       </Authorize>
   </Rule>

  <!-- Rule for allowing LPC read-only access to the usb registry -->
  <Rule Description="Allows LPC to read to USB registry keys." ResourceIri="$(HKLM)/DRIVERS/USB/(*)" SpeakerAccountId="$(SYSTEM_USER_NAME)" PriorityCategoryId="PRIORITY_HIGH">
    <Authorize>
      <Match AccountId="$(EVERYONE_GROUP_NAME)" AuthorizationIds="KEY_READ"></Match>
    </Authorize>
  </Rule>
</CeSecurityPolicyFile>
